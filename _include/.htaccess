# redirect rules to prevent old links from breaking
RewriteEngine On

RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

RewriteRule ^/?docs/0.6-incubating/(.*) https://nightlies.apache.org/flink/flink-docs-release-0.6/$1  [R=301,L,NE]
RewriteRule ^/?docs/0.7-incubating/(.*) https://nightlies.apache.org/flink/flink-docs-release-0.7/$1  [R=301,L,NE]
RewriteRule ^/?docs/0.8/(.*) https://nightlies.apache.org/flink/flink-docs-release-0.8/$1  [R=301,L,NE]
RewriteRule ^/?docs/latest(/.*)? https://nightlies.apache.org/flink/flink-docs-master$1  [R=301,L,NE]
RewriteRule ^/?docs/stable(/.*)? https://nightlies.apache.org/flink/flink-docs-release-0.8$1  [R=301,L,NE]
RewriteRule ^/?docs/(.*) https://nightlies.apache.org/flink/flink-docs-master/$1  [R=301,L,NE]

# Generic redirect rule that should redirect users from all old blog posts to their new URLs
# Example 1: https://flink.apache.org/news/2023/01/30/release-1.16.1.html to https://flink.apache.org/posts/2023-01-26-release-1.16.1/
# Example 2: https://flink.apache.org/2022/11/25/async-sink-rate-limiting-strategy.html to https://flink.apache.org/posts/2022-11-25-async-sink-rate-limiting-strategy/
RewriteRule ^news/(\d+)/(\d+)/(\d+)/(.*)$ /posts/$1-$2-$3-$4 [R=301,L]

# English URLs
RewriteRule ^/flink-architecture.html$ /docs/what-is-flink/flink-architecture/ [R=301,L]
RewriteRule ^/flink-applications.html$ /docs/what-is-flink/flink-applications/ [R=301,L]
RewriteRule ^/flink-operations.html$ /docs/what-is-flink/flink-operations/ [R=301,L]
RewriteRule ^/usecases.html$ /docs/use-cases/ [R=301,L]
RewriteRule ^/poweredby.html$ /docs/powered-by/ [R=301,L]
RewriteRule ^/downloads.html$ /docs/downloads/ [R=301,L]
RewriteRule ^/gettinghelp.html$ /docs/getting-help/ [R=301,L]
RewriteRule ^/blog/$ /posts/ [R=301,L]
RewriteRule ^/community.html$ /docs/community/ [R=301,L]
RewriteRule ^/roadmap.html$ /docs/roadmap/ [R=301,L]
RewriteRule ^/contributing/how-to-contribute.html$ /docs/contribute/how-to-contribute/ [R=301,L]
RewriteRule ^/contributing/contribute-code.html$ /docs/contribute/contribute-code/ [R=301,L]
RewriteRule ^/contributing/reviewing-prs.html$ /docs/contribute/reviewing-prs/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-preamble.html$ /docs/contribute/code-style-and-quality/preamble/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-pull-requests.html$ /docs/contribute/code-style-and-quality/pull-requests/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-common.html$ /docs/contribute/code-style-and-quality/common/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-java.html$ /docs/contribute/code-style-and-quality/java/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-scala.html$ /docs/contribute/code-style-and-quality/scala/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-components.html$ /docs/contribute/code-style-and-quality/components/ [R=301,L]
RewriteRule ^/contributing/code-style-and-quality-formatting.html$ /docs/contribute/code-style-and-quality/formatting/ [R=301,L]
RewriteRule ^contributing/code-style-and-quality-formatting\.html$ /docs/how-to-contribute/code-style-and-quality-formatting/ [R=301,L]
RewriteRule ^contributing/contribute-documentation\.html$ /docs/how-to-contribute/contribute-documentation/ [R=301,L]
RewriteRule ^contributing/docs-style\.html$ /docs/how-to-contribute/documentation-style-guide/ [R=301,L]
RewriteRule ^contributing/improve-website\.html$ /docs/how-to-contribute/improve-website/ [R=301,L]
RewriteRule ^security\.html$ /docs/security/ [R=301,L]

# Chinese URLs
RewriteRule ^zh/flink-architecture\.html$ /zh/docs/what-is-flink/flink-architecture/ [R=301,L]
RewriteRule ^zh/flink-applications\.html$ /zh/docs/what-is-flink/flink-applications/ [R=301,L]
RewriteRule ^zh/flink-operations\.html$ /zh/docs/what-is-flink/flink-operations/ [R=301,L]
RewriteRule ^zh/usecases\.html$ /zh/docs/use-cases/ [R=301,L]
RewriteRule ^zh/poweredby\.html$ /zh/docs/powered-by/ [R=301,L]
RewriteRule ^zh/downloads\.html$ /zh/docs/downloads/ [R=301,L]
RewriteRule ^zh/gettinghelp\.html$ /zh/docs/getting-help/ [R=301,L]
RewriteRule ^zh/blog/$ /zh/posts/ [R=301,L]
RewriteRule ^zh/community\.html$ /zh/docs/community/ [R=301,L]
RewriteRule ^zh/roadmap\.html$ /zh/docs/roadmap/ [R=301,L]
RewriteRule ^zh/contributing/how-to-contribute\.html$ /zh/docs/how-to-contribute/overview/ [R=301,L]
RewriteRule ^zh/contributing/contribute-code\.html$ /zh/docs/how-to-contribute/contribute-code/ [R=301,L]
RewriteRule ^zh/contributing/reviewing-prs\.html$ /zh/docs/how-to-contribute/reviewing-prs/ [R=301,L]
RewriteRule ^zh/contributing/code-style-and-quality-preamble\.html$ /zh/docs/how-to-contribute/code-style-and-quality-preamble/ [R=301,L]
RewriteRule ^zh/contributing/code-style-and-quality-pull-requests\.html$ /zh/docs/how-to-contribute/code-style-and-quality-pull-requ
